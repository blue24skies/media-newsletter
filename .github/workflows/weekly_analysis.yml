name: Weekly Learning Analysis

on:
  schedule:
    # Jeden Sonntag um 22:00 Uhr Berlin Zeit (21:00 UTC im Winter, 20:00 UTC im Sommer)
    - cron: '0 21 * * 0'
  
  # Manueller Trigger fÃ¼r Tests
  workflow_dispatch:

jobs:
  analyze-and-learn:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
    
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4
    
    - name: Set up Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install Dependencies
      run: |
        pip install supabase==2.3.4
    
    - name: Run Weekly Analysis
      env:
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
      run: |
        python weekly_analysis.py
    
    - name: Commit Learning Rules
      run: |
        git config user.name "Learning Bot"
        git config user.email "learning-bot@zooproductions.de"
        
        # FÃ¼ge learning_rules.py hinzu falls erstellt
        git add learning_rules.py 2>/dev/null || true
        
        # Commit nur wenn es Ã„nderungen gibt
        git diff --staged --quiet || git commit -m "ðŸ¤– Update learning rules - $(date +%Y-%m-%d)"
        
        # Push (ignoriere Fehler falls nichts zu pushen)
        git push || true
